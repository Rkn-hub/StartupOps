<!DOCTYPE html>
<html class="dark overflow-x-hidden" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Startup Equity Calculator - StartupOps</title>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <!-- Standardized Styles -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }
        html {
            overflow-x: hidden;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
        }
        .gradient-text {
            background: linear-gradient(90deg, #64FFDA, #64FFDA);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .glassmorphism {
            background: rgba(42, 42, 42, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 255, 218, 0.3);
        }
        
        @layer base {
            :root {
                --slider-handle-color: #64FFDA;
                --slider-track-bg: rgba(255, 255, 255, 0.1);
                --slider-range-bg: #64FFDA;
            }
            input[type="range"] {
                -webkit-appearance: none;
                appearance: none;
                background: transparent;
                cursor: pointer;
                width: 100%;
            }
            input[type="range"]::-webkit-slider-runnable-track {
                background: var(--slider-track-bg);
                height: 0.25rem;
                border-radius: 9999px;
            }
            input[type="range"]::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                margin-top: -6px;
                background-color: var(--slider-handle-color);
                height: 1rem;
                width: 1rem;
                border-radius: 9999px;
                border: 2px solid #0A0A1A;
            }
            input[type="range"]::-moz-range-track {
                background: var(--slider-track-bg);
                height: 0.25rem;
                border-radius: 9999px;
            }
            input[type="range"]::-moz-range-thumb {
                background-color: var(--slider-handle-color);
                height: 1rem;
                width: 1rem;
                border-radius: 9999px;
                border: 2px solid #0A0A1A;
            }
            
            select {
                position: relative;
                z-index: 20;
            }
            
            select:focus {
                z-index: 30;
            }
            
            select option {
                background-color: #1d242f;
                color: white;
                padding: 8px 12px;
            }
            
            .dropdown-container {
                position: relative;
                z-index: 20;
            }
            
            .dropdown-container:focus-within {
                z-index: 30;
            }
        }
    </style>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#212121",
                        "background-dark": "#212121",
                        "accent": "#64FFDA",
                        "text-primary": "#FFFFFF",
                        "text-secondary": "#B0B0B0",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"],
                        "heading": ["Poppins", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem", 
                        "lg": "1rem", 
                        "xl": "1.5rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    
    <!-- Supabase Integration -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- New Equity Calculator Logic -->
    <script src="js/equity-calculator-new.js"></script>
</head>
<body class="bg-background-dark font-display text-text-primary overflow-x-hidden">
    <!-- Hero Container with Background -->
    <div class="relative w-full">
        <!-- Standardized Background Elements -->
        <div class="absolute top-0 left-0 w-full h-[600px] bg-gradient-to-b from-primary/30 to-transparent z-0"></div>
        <div class="absolute top-[-200px] right-[-200px] w-[500px] h-[500px] bg-accent/10 rounded-full blur-3xl z-0"></div>
        <div class="absolute top-[300px] left-[-250px] w-[600px] h-[600px] bg-accent/5 rounded-full blur-3xl z-0"></div>
        
        <!-- Content Container -->
        <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            
            <!-- STANDARDIZED NAVIGATION -->
            <header class="flex items-center justify-between py-6">
                <!-- Logo Section -->
                <div class="flex items-center gap-4 text-white">
                    <div class="size-6 text-accent">
                        <svg fill="none" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                            <path d="M42.4379 44C42.4379 44 36.0744 33.9038 41.1692 24C46.8624 12.9336 42.2078 4 42.2078 4L7.01134 4C7.01134 4 11.6577 12.932 5.96912 23.9969C0.876273 33.9029 7.27094 44 7.27094 44L42.4379 44Z" fill="currentColor"></path>
                        </svg>
                    </div>
                    <h2 class="text-white text-xl font-bold font-heading">StartupOps</h2>
                </div>
                
                <!-- Navigation Links -->
                <nav class="hidden md:flex items-center gap-8 text-sm">
                    <a class="text-gray-300 hover:text-white transition-colors" href="index.html">Home</a>
                    <a class="text-gray-300 hover:text-white transition-colors" href="services.html">Services</a>
                    <a class="text-gray-300 hover:text-white transition-colors" href="portfolio.html">Portfolio</a>
                    <a class="text-gray-300 hover:text-white transition-colors" href="about.html">About</a>
                    <a class="text-gray-300 hover:text-white transition-colors" href="how-it-works.html">How It Works</a>
                    <a class="text-accent" href="equity-calculator.html">Calculator</a>
                </nav>
                
                <!-- CTA Button -->
                <button onclick="window.location.href='contact.html'" class="hidden md:flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-5 bg-primary/80 border border-accent/30 text-white text-sm font-semibold leading-normal hover:bg-primary transition-all hover:shadow-lg hover:shadow-accent/20">
                    <span class="truncate">Contact Us</span>
                </button>
            </header>

            <!-- STANDARDIZED HERO CONTENT -->
            <main class="py-20 sm:py-28 text-center">
                <div class="max-w-4xl mx-auto">
                    <!-- Main Heading -->
                    <h1 class="text-5xl md:text-7xl font-bold font-heading tracking-tighter text-white leading-tight">
                        Startup <span class="gradient-text">Equity</span> Calculator
                    </h1>
                    
                    <!-- Subtitle -->
                    <h2 class="mt-6 max-w-2xl mx-auto text-lg text-gray-400">
                        Calculate your exact equity percentage using our proven algorithm. Based on service value, startup risk, and founder commitment.
                    </h2>
                    
                    <!-- CTA Buttons -->
                    <div class="mt-10 flex flex-wrap gap-4 justify-center">
                        <!-- Primary CTA -->
                        <button onclick="document.getElementById('calculator-form').scrollIntoView({behavior: 'smooth'})" class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-12 px-6 bg-accent text-black text-base font-bold leading-normal tracking-wide shadow-lg shadow-accent/20 transition-all hover:scale-105 hover:shadow-xl hover:shadow-accent/30">
                            <span class="truncate">Calculate Now</span>
                        </button>
                        
                        <!-- Secondary CTA -->
                        <button onclick="window.location.href='contact.html'" class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-12 px-6 bg-white/10 border border-white/20 text-white text-base font-bold leading-normal tracking-wide backdrop-blur-sm transition-all hover:bg-white/20 hover:border-white/30">
                            <span class="truncate">Contact Us</span>
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Calculator Content Section -->
    <div class="relative w-full">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
            <!-- Glassmorphic Card Container -->
            <div id="calculator-form" class="w-full max-w-4xl mx-auto rounded-xl border border-accent/20 bg-white/5 p-8 md:p-12 shadow-[0_0_80px_-20px_rgba(100,255,218,0.2)] backdrop-blur-xl">

                <!-- Calculator Form -->
                <div class="space-y-8">
                    <!-- Pricing Mode Toggle -->
                    <div>
                        <h3 class="text-white text-xl font-bold mb-4">Choose Your Pricing</h3>
                        <div class="flex gap-4 mb-6">
                            <label class="flex items-center space-x-3 p-4 rounded-lg border border-accent/40 bg-accent/10 cursor-pointer transition-colors hover:bg-accent/20">
                                <input type="radio" name="pricingMode" value="STUDENT" checked class="text-accent focus:ring-accent" onchange="switchPricingMode('STUDENT')">
                                <div>
                                    <div class="text-white font-medium">Student Founder</div>
                                    <div class="text-gray-300 text-sm">Special student-friendly rates</div>
                                </div>
                            </label>
                            <label class="flex items-center space-x-3 p-4 rounded-lg border border-white/20 bg-white/5 cursor-pointer transition-colors hover:bg-white/10">
                                <input type="radio" name="pricingMode" value="PRO" class="text-accent focus:ring-accent" onchange="switchPricingMode('PRO')">
                                <div>
                                    <div class="text-white font-medium">Professional / Startup</div>
                                    <div class="text-gray-300 text-sm">Standard business rates</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Services Selection -->
                    <div>
                        <h3 class="text-white text-xl font-bold mb-4">What services do you need?</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <label class="flex items-center space-x-3 p-3 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 cursor-pointer transition-colors">
                                <input type="checkbox" class="service-checkbox" data-service="branding" data-price="30000">
                                <div>
                                    <div class="text-white font-medium">Branding & Strategy</div>
                                    <div class="text-accent text-sm">₹30,000 student price</div>
                                </div>
                            </label>
                            <label class="flex items-center space-x-3 p-3 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 cursor-pointer transition-colors">
                                <input type="checkbox" class="service-checkbox" data-service="pitchdeck" data-price="20000">
                                <div>
                                    <div class="text-white font-medium">Pitch Deck Design</div>
                                    <div class="text-accent text-sm">₹20,000 student price</div>
                                </div>
                            </label>
                            <label class="flex items-center space-x-3 p-3 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 cursor-pointer transition-colors">
                                <input type="checkbox" class="service-checkbox" data-service="website" data-price="30000">
                                <div>
                                    <div class="text-white font-medium">Website Development</div>
                                    <div class="text-accent text-sm">₹30,000 student price</div>
                                </div>
                            </label>
                            <label class="flex items-center space-x-3 p-3 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 cursor-pointer transition-colors">
                                <input type="checkbox" class="service-checkbox" data-service="mvp" data-price="90000">
                                <div>
                                    <div class="text-white font-medium">MVP Development</div>
                                    <div class="text-accent text-sm">₹90,000 student price</div>
                                </div>
                            </label>
                            <label class="flex items-center space-x-3 p-3 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 cursor-pointer transition-colors">
                                <input type="checkbox" class="service-checkbox" data-service="mobileapp" data-price="150000">
                                <div>
                                    <div class="text-white font-medium">Mobile App Development</div>
                                    <div class="text-accent text-sm">₹1,50,000 student price</div>
                                </div>
                            </label>
                            <label class="flex items-center space-x-3 p-3 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 cursor-pointer transition-colors">
                                <input type="checkbox" class="service-checkbox" data-service="uiux" data-price="25000">
                                <div>
                                    <div class="text-white font-medium">UI/UX Design</div>
                                    <div class="text-accent text-sm">₹25,000 student price</div>
                                </div>
                            </label>
                            <label class="flex items-center space-x-3 p-3 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 cursor-pointer transition-colors">
                                <input type="checkbox" class="service-checkbox" data-service="legal" data-price="10000">
                                <div>
                                    <div class="text-white font-medium">Legal Documentation</div>
                                    <div class="text-accent text-sm">₹10,000 student price</div>
                                </div>
                            </label>
                            <label class="flex items-center space-x-3 p-3 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 cursor-pointer transition-colors">
                                <input type="checkbox" class="service-checkbox" data-service="marketing" data-price="20000">
                                <div>
                                    <div class="text-white font-medium">Marketing Setup</div>
                                    <div class="text-accent text-sm">₹20,000 student price</div>
                                </div>
                            </label>
                            <label class="flex items-center space-x-3 p-3 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 cursor-pointer transition-colors">
                                <input type="checkbox" class="service-checkbox" data-service="fundraising" data-price="35000">
                                <div>
                                    <div class="text-white font-medium">Fundraising Support</div>
                                    <div class="text-accent text-sm">₹35,000 student price</div>
                                </div>
                            </label>
                            <label class="flex items-center space-x-3 p-3 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 cursor-pointer transition-colors">
                                <input type="checkbox" class="service-checkbox" data-service="fullpackage" data-price="199000">
                                <div>
                                    <div class="text-white font-medium">Full Startup Package</div>
                                    <div class="text-accent text-sm">₹1,99,000 student price</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Founder Commitment Questions -->
                    <div>
                        <h3 class="text-white text-xl font-bold mb-4">Tell us about yourself</h3>
                        <div class="space-y-4">
                            <label class="flex items-center space-x-3 p-3 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 cursor-pointer transition-colors">
                                <input type="checkbox" id="fullTimeFounder" class="commitment-checkbox">
                                <div class="text-white">Are you working on your startup full-time?</div>
                            </label>
                            <label class="flex items-center space-x-3 p-3 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 cursor-pointer transition-colors">
                                <input type="checkbox" id="ownMoneyInvested" class="commitment-checkbox">
                                <div class="text-white">Have you put your own money into this startup?</div>
                            </label>
                            <label class="flex items-center space-x-3 p-3 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 cursor-pointer transition-colors">
                                <input type="checkbox" id="clearRoadmap" class="commitment-checkbox">
                                <div class="text-white">Do you have a clear plan for the next 6-12 months?</div>
                            </label>
                        </div>
                        <div class="mt-2 text-sm text-gray-300">
                            <span id="commitmentScore">Your commitment level: Medium</span>
                        </div>
                    </div>

                    <!-- Configuration Options -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Startup Stage -->
                        <label class="flex flex-col">
                            <p class="text-white text-base font-medium leading-normal pb-2">What stage is your startup at?</p>
                            <div class="dropdown-container relative z-20">
                                <select id="startupStage" class="form-select appearance-none w-full resize-none overflow-hidden rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary/50 border border-white/20 bg-[#1d242f]/50 h-14 pl-4 pr-16 text-base font-normal leading-normal relative z-10">
                                    <option value="idea">Just an idea</option>
                                    <option value="mvp_building">Building my first version</option>
                                    <option value="mvp_live">Have a working product</option>
                                    <option value="revenue">Making some money</option>
                                </select>
                                <span class="material-symbols-outlined pointer-events-none absolute right-4 top-1/2 -translate-y-1/2 text-gray-300 z-20 text-xl">unfold_more</span>
                            </div>
                        </label>

                        <!-- Cash Contribution Slider -->
                        <label class="flex flex-col">
                            <div class="flex justify-between items-center pb-2">
                                <p class="text-white text-base font-medium leading-normal">How much can you pay in cash?</p>
                                <p id="cashPercentage" class="text-accent text-lg font-bold">50%</p>
                            </div>
                            <input id="cashSlider" class="w-full h-2 rounded-lg appearance-none cursor-pointer mt-4" max="100" min="15" type="range" value="50"/>
                            <div class="text-xs text-gray-300 mt-1">Higher cash = Lower equity. Minimum 15% for students, 30% for professionals.</div>
                        </label>
                    </div>

                    <!-- Calculate Button -->
                    <div class="text-center">
                        <button id="calculateBtn" class="flex w-full md:w-auto md:min-w-[200px] mx-auto cursor-pointer items-center justify-center overflow-hidden rounded-lg h-14 px-8 bg-accent text-black text-lg font-bold leading-normal tracking-[0.015em] shadow-[0_0_20px_rgba(100,255,218,0.4)] hover:shadow-[0_0_30px_rgba(100,255,218,0.6)] transition-shadow duration-300">
                            <span class="material-symbols-outlined mr-2 text-black">calculate</span>
                            <span class="truncate text-black">Calculate Equity</span>
                        </button>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="resultsSection" class="mt-12 border-t border-white/10 pt-10 hidden">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- Stat Card: Service Price -->
                        <div class="flex flex-col items-center justify-center gap-2 rounded-lg border border-white/10 bg-white/5 p-6 text-center">
                            <p class="text-sm font-medium text-gray-300">Service Price</p>
                            <p id="marketValueResult" class="text-3xl font-black text-white tracking-tighter">₹1,20,000</p>
                        </div>
                        <!-- Stat Card: Adjusted Value -->
                        <div class="flex flex-col items-center justify-center gap-2 rounded-lg border border-white/10 bg-white/5 p-6 text-center">
                            <p class="text-sm font-medium text-gray-300">Adjusted Value</p>
                            <p id="discountedPriceResult" class="text-3xl font-black text-white tracking-tighter">₹1,56,000</p>
                        </div>
                        <!-- Stat Card: Cash Payment -->
                        <div class="flex flex-col items-center justify-center gap-2 rounded-lg border border-white/10 bg-white/5 p-6 text-center">
                            <p class="text-sm font-medium text-gray-300">Cash Payment</p>
                            <p id="cashResult" class="text-3xl font-black text-white tracking-tighter">₹78,000</p>
                        </div>
                        <!-- Stat Card: Equity -->
                        <div class="flex flex-col items-center justify-center gap-2 rounded-lg border border-accent/40 bg-accent/10 p-6 text-center">
                            <p class="text-sm font-medium text-accent/90">Equity Percentage</p>
                            <p id="equityResult" class="text-3xl font-black text-accent tracking-tighter">2.0%</p>
                        </div>
                    </div>
                    
                    <!-- Model Type -->
                    <div class="mt-6 text-center">
                        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-accent/40 bg-accent/10">
                            <span class="text-accent font-medium">Recommended Model:</span>
                            <span id="planResult" class="text-accent font-bold">Hybrid Model</span>
                        </div>
                    </div>

                    <!-- Breakdown Details -->
                    <div class="mt-8 p-6 rounded-lg border border-white/10 bg-white/5">
                        <h4 class="text-white text-lg font-bold mb-4">Calculation Breakdown</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <p class="text-gray-300">Selected Services: <span id="selectedServicesResult" class="text-white">4 services</span></p>
                                <p class="text-gray-300">Startup Stage: <span id="stageResult" class="text-white">MVP Building</span></p>
                                <p class="text-gray-300">Founder Commitment: <span id="growthResult" class="text-white">High</span></p>
                                <p class="text-gray-300">Cash Contribution: <span id="cashContributionResult" class="text-white">50%</span></p>
                            </div>
                            <div>
                                <p class="text-gray-300">Equity Type: <span id="equityTypeResult" class="text-accent">Advisory Equity</span></p>
                                <p class="text-gray-300">Vesting Period: <span id="vestingResult" class="text-white">24 months</span></p>
                                <p class="text-gray-300">Deal Status: <span id="dealStatusResult" class="text-accent">Approved for Hybrid</span></p>
                                <p class="text-gray-300">Equity Range: <span class="text-accent">1-8% (capped)</span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Post-Calculation CTA -->
                    <div class="mt-8 text-center">
                        <a class="inline-flex items-center gap-2 text-accent hover:text-white transition-colors group" href="contact.html">
                            <span class="font-semibold">Discuss My Project</span>
                            <span class="material-symbols-outlined transition-transform group-hover:translate-x-1">arrow_forward</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Pricing mode functionality
        let currentPricingMode = 'STUDENT';
        
        function switchPricingMode(mode) {
            currentPricingMode = mode;
            console.log('Switched to pricing mode:', mode);
            
            // Update visual feedback
            document.querySelectorAll('input[name="pricingMode"]').forEach(radio => {
                const label = radio.closest('label');
                if (radio.value === mode) {
                    label.classList.remove('border-white/20', 'bg-white/5');
                    label.classList.add('border-accent/40', 'bg-accent/10');
                } else {
                    label.classList.remove('border-accent/40', 'bg-accent/10');
                    label.classList.add('border-white/20', 'bg-white/5');
                }
            });
            
            // Update service prices display (optional - could show different prices)
            updateServicePricesDisplay(mode);
        }
        
        function updateServicePricesDisplay(mode) {
            // Update the displayed prices based on mode
            const serviceCards = document.querySelectorAll('.service-checkbox');
            serviceCards.forEach(checkbox => {
                const service = checkbox.dataset.service;
                const priceDisplay = checkbox.parentElement.querySelector('.text-accent');
                
                if (window.EquityCalculatorNew && window.EquityCalculatorNew.SERVICES) {
                    const newPrice = window.EquityCalculatorNew.SERVICES[mode][service];
                    if (newPrice && priceDisplay) {
                        const modeText = mode === 'STUDENT' ? 'student' : 'professional';
                        priceDisplay.textContent = `₹${newPrice.toLocaleString()} ${modeText} price`;
                        
                        // Also update the data-price attribute for consistency
                        checkbox.dataset.price = newPrice;
                    }
                }
            });
        }

        // Update cash percentage display and recalculate in real-time
        const cashSlider = document.getElementById('cashSlider');
        const cashPercentage = document.getElementById('cashPercentage');
        
        cashSlider.addEventListener('input', function() {
            cashPercentage.textContent = this.value + '%';
            
            // Real-time calculation update when slider changes
            updateFromCashSlider(this.value);
        });

        // Real-time calculation function (similar to reference)
        function updateFromCashSlider(cashPercent) {
            // Only update if we have selected services
            const selectedServices = [];
            document.querySelectorAll('.service-checkbox:checked').forEach(checkbox => {
                selectedServices.push(checkbox.dataset.service);
            });

            if (selectedServices.length === 0) {
                return; // No services selected, don't calculate
            }

            try {
                // Get current form values
                const stage = document.getElementById('startupStage').value;
                const founderCommitment = calculateFounderCommitmentLevel();
                
                // Calculate total service price
                let totalServicePrice = 0;
                selectedServices.forEach(service => {
                    if (window.EquityCalculatorNew && window.EquityCalculatorNew.SERVICES) {
                        const price = window.EquityCalculatorNew.SERVICES[currentPricingMode][service];
                        if (price) totalServicePrice += price;
                    }
                });

                if (totalServicePrice === 0) return;

                // Map stage to calculation format
                const stageMap = {
                    'idea': 'IDEA',
                    'mvp_building': 'MVP_BUILDING',
                    'mvp_live': 'MVP_LIVE', 
                    'revenue': 'REVENUE'
                };
                const mappedStage = stageMap[stage] || 'IDEA';

                // Get multipliers from calculator
                const stageMultiplier = window.EquityCalculatorNew.STAGE_MULTIPLIER[mappedStage];
                const founderScore = window.EquityCalculatorNew.FOUNDER_SCORE[founderCommitment];
                const valuation = window.EquityCalculatorNew.VALUATION[currentPricingMode][mappedStage];

                // Calculate ASV (Adjusted Service Value)
                const ASV = totalServicePrice * stageMultiplier * founderScore;
                
                // Calculate cash amount from percentage
                const cashAmount = (cashPercent / 100) * ASV;
                
                // Calculate equity
                const equityValue = ASV - cashAmount;
                let equityPercent = (equityValue / valuation) * 100;
                
                // Apply caps (0% to 8%)
                equityPercent = Math.min(Math.max(equityPercent, 0), 8);

                // Update display elements if they exist (for real-time preview)
                const marketValueEl = document.getElementById('marketValueResult');
                const adjustedValueEl = document.getElementById('discountedPriceResult');
                const cashResultEl = document.getElementById('cashResult');
                const equityResultEl = document.getElementById('equityResult');

                if (marketValueEl) marketValueEl.textContent = '₹' + totalServicePrice.toLocaleString('en-IN');
                if (adjustedValueEl) adjustedValueEl.textContent = '₹' + Math.round(ASV).toLocaleString('en-IN');
                if (cashResultEl) cashResultEl.textContent = '₹' + Math.round(cashAmount).toLocaleString('en-IN');
                if (equityResultEl) equityResultEl.textContent = equityPercent.toFixed(1) + '%';

            } catch (error) {
                console.log('Real-time calculation error (non-critical):', error);
            }
        }

        // Helper function to get current founder commitment level
        function calculateFounderCommitmentLevel() {
            const fullTime = document.getElementById('fullTimeFounder')?.checked || false;
            const ownMoney = document.getElementById('ownMoneyInvested')?.checked || false;
            const roadmap = document.getElementById('clearRoadmap')?.checked || false;
            
            const yesCount = [fullTime, ownMoney, roadmap].filter(Boolean).length;
            
            if (yesCount <= 1) return 'LOW';
            if (yesCount === 2) return 'MEDIUM';
            return 'HIGH';
        }

        // Update commitment score display
        function updateCommitmentScore() {
            const fullTime = document.getElementById('fullTimeFounder').checked;
            const ownMoney = document.getElementById('ownMoneyInvested').checked;
            const roadmap = document.getElementById('clearRoadmap').checked;
            
            const yesCount = [fullTime, ownMoney, roadmap].filter(Boolean).length;
            
            let level, color;
            if (yesCount <= 1) {
                level = 'Low';
                color = 'text-red-400';
            } else if (yesCount === 2) {
                level = 'Medium';
                color = 'text-yellow-400';
            } else {
                level = 'High';
                color = 'text-green-400';
            }
            
            const scoreElement = document.getElementById('commitmentScore');
            scoreElement.textContent = `Your commitment level: ${level}`;
            scoreElement.className = `mt-2 text-sm ${color}`;
        }

        // Add commitment checkbox listeners with real-time updates
        document.querySelectorAll('.commitment-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                updateCommitmentScore();
                // Trigger real-time calculation update
                const currentCashPercent = document.getElementById('cashSlider').value;
                updateFromCashSlider(currentCashPercent);
            });
        });

        // Calculate button event listener
        document.getElementById('calculateBtn').addEventListener('click', async function() {
            console.log('Calculate button clicked');
            
            // Get selected services
            const selectedServices = [];
            document.querySelectorAll('.service-checkbox:checked').forEach(checkbox => {
                selectedServices.push(checkbox.dataset.service);
            });

            console.log('Selected services:', selectedServices);

            if (selectedServices.length === 0) {
                alert('Please select at least one service to calculate equity.');
                return;
            }

            // Get form values
            const stage = document.getElementById('startupStage').value;
            const cashPercent = parseInt(document.getElementById('cashSlider').value);
            
            // Calculate founder commitment manually (more reliable)
            const fullTime = document.getElementById('fullTimeFounder').checked;
            const ownMoney = document.getElementById('ownMoneyInvested').checked;
            const roadmap = document.getElementById('clearRoadmap').checked;
            
            const yesCount = [fullTime, ownMoney, roadmap].filter(Boolean).length;
            let founderCommitment;
            if (yesCount <= 1) founderCommitment = 'LOW';
            else if (yesCount === 2) founderCommitment = 'MEDIUM';
            else founderCommitment = 'HIGH';

            console.log('Debug - Input values:', {
                selectedServices,
                stage,
                cashPercent,
                founderCommitment,
                yesCount,
                fullTime,
                ownMoney,
                roadmap
            });

            // Check if EquityCalculatorNew is available
            if (!window.EquityCalculatorNew) {
                console.error('EquityCalculatorNew not available');
                alert('Calculator not loaded properly. Please refresh the page and try again.');
                return;
            }

            console.log('EquityCalculatorNew functions:', Object.keys(window.EquityCalculatorNew));

            try {
                // Calculate equity using new logic with selected pricing mode
                const result = window.EquityCalculatorNew.calculateAccurateEquity(selectedServices, cashPercent, stage, founderCommitment, currentPricingMode);
                console.log('Raw calculation result:', result);

                if (!result) {
                    throw new Error('Calculator returned null/undefined result');
                }

                if (typeof result.equityPercent === 'undefined') {
                    throw new Error('Calculator result missing equityPercent');
                }

                console.log('Debug - Calculation result:', result);

                // Display results
                document.getElementById('marketValueResult').textContent = '₹' + result.servicePrice.toLocaleString('en-IN');
                document.getElementById('discountedPriceResult').textContent = '₹' + result.adjustedValue.toLocaleString('en-IN');
                document.getElementById('cashResult').textContent = '₹' + result.cashPayable.toLocaleString('en-IN');
                document.getElementById('equityResult').textContent = result.equityPercent + '%';
                document.getElementById('planResult').textContent = result.dealType;

                // Update breakdown details
                document.getElementById('selectedServicesResult').textContent = result.selectedServicesCount + ' services';
                document.getElementById('stageResult').textContent = stage.charAt(0).toUpperCase() + stage.slice(1).replace('_', ' ');
                document.getElementById('growthResult').textContent = founderCommitment;
                document.getElementById('cashContributionResult').textContent = `${cashPercent}% (₹${result.cashPayable.toLocaleString()})`;
                
                // Update additional details
                document.getElementById('equityTypeResult').textContent = result.equityType;
                document.getElementById('vestingResult').textContent = result.vesting;
                document.getElementById('dealStatusResult').textContent = result.dealStatus;

                // Show results
                document.getElementById('resultsSection').classList.remove('hidden');
                
                // Scroll to results
                document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error('Calculation error:', error);
                alert('Calculation failed: ' + error.message + '. Please check console for details.');
                return;
            }

            // Save calculation to Supabase (optional - for analytics)
            try {
                const calculationData = {
                    selected_services: selectedServices,
                    cash_contribution: cashPercent,
                    startup_stage: stage,
                    founder_commitment: founderCommitment,
                    service_price: result.servicePrice,
                    adjusted_value: result.adjustedValue,
                    cash_paid: result.cashPayable,
                    equity_percent: result.equityPercent,
                    recommended_model: result.dealType,
                    deal_status: result.dealStatus
                };

                // Load and use Supabase client if available
                if (window.StartupOpsDB) {
                    await window.StartupOpsDB.saveEquityCalculation(calculationData);
                }

                // Track analytics event
                if (window.gtag) {
                    gtag('event', 'equity_calculation_new', {
                        event_category: 'engagement',
                        event_label: 'new_calculator_used',
                        value: result.servicePrice
                    });
                }
            } catch (error) {
                console.log('Analytics save failed (non-critical):', error);
            }
        });

        // Add visual feedback for service selection with real-time updates
        document.querySelectorAll('.service-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const label = this.closest('label');
                if (this.checked) {
                    label.classList.add('border-accent/60', 'bg-accent/10');
                } else {
                    label.classList.remove('border-accent/60', 'bg-accent/10');
                }
                
                // Trigger real-time calculation update
                const currentCashPercent = document.getElementById('cashSlider').value;
                updateFromCashSlider(currentCashPercent);
            });
        });

        // Load Supabase client when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Load Supabase client script
            const script = document.createElement('script');
            script.src = 'js/supabase-client.js';
            script.onload = function() {
                console.log('Supabase client loaded for equity calculator');
            };
            document.head.appendChild(script);
            
            // Initialize commitment score
            updateCommitmentScore();
            
            // Initialize pricing mode display
            setTimeout(() => {
                updateServicePricesDisplay(currentPricingMode);
            }, 100);
            
            // Add real-time update listener to startup stage dropdown
            document.getElementById('startupStage').addEventListener('change', function() {
                const currentCashPercent = document.getElementById('cashSlider').value;
                updateFromCashSlider(currentCashPercent);
            });
            
            // Debug: Check if EquityCalculatorNew is loaded
            console.log('EquityCalculatorNew available:', !!window.EquityCalculatorNew);
            if (window.EquityCalculatorNew) {
                console.log('Available functions:', Object.keys(window.EquityCalculatorNew));
            } else {
                console.error('EquityCalculatorNew not loaded! Check js/equity-calculator-new.js');
            }
        });
    </script>
</body>
</html>